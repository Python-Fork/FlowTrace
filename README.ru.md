> üåê English version: [README.md](README.md)
# üåÄ FlowTrace ‚Äî —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è Python 3.12+

> FlowTrace ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ç—Ä–µ–π—Å—Å–µ—Ä, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ Monitoring API Python (PEP 669).
–û–Ω –Ω–µ –∏–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äú–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é‚Äù ‚Äî –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç,
—á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ: –≤—ã–∑–æ–≤—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚Äî
—Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –∏ –±–µ–∑ monkey-patching.

> –°—Ç–∞—Ç—É—Å: —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∞–ª—å—Ñ–∞-–≤–µ—Ä—Å–∏—è. –¢—Ä–µ–±—É–µ—Ç—Å—è Python 3.12 –∏ –≤—ã—à–µ.
---
–£—Å—Ç–∞–Ω–æ–≤–∫–∞
```
pip install flowtrace
```
---
## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
### 1) –û–¥–∏–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
```python
from flowtrace import trace

@trace
def fib(n):
    return n if n < 2 else fib(n-1) + fib(n-2)

fib(3)
```

–í—ã–≤–æ–¥:

```
‚Üí fib(3)
  ‚Üí fib(2)
    ‚Üí fib(1) ‚Üí 1
    ‚Üí fib(0) ‚Üí 0
  ‚Üê fib(2) ‚Üí 1
  ‚Üí fib(1) ‚Üí 1
‚Üê fib(3) ‚Üí 2
```
## 2) –í—Ä–µ–º—è ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
```python
from flowtrace import trace

@trace(measure_time=True)
def compute(a, b):
    return a * b

compute(6, 7)
```

–í—ã–≤–æ–¥:

```
‚Üí compute(6, 7) [0.000265s] ‚Üí 42
```
---
## 3) –†—É—á–Ω–∞—è —Å–µ—Å—Å–∏—è
```python
from flowtrace import start_tracing, stop_tracing, print_tree

def fib(n):
    return n if n < 2 else fib(n-1) + fib(n-2)

start_tracing()     # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏, —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
fib(3)
events = stop_tracing()
print_tree(events)
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚Üí fib()
  ‚Üí fib()
    ‚Üí fib()  ‚Üí 1
    ‚Üí fib()  ‚Üí 0
  ‚Üê fib()  ‚Üí 1
  ‚Üí fib()  ‚Üí 1
‚Üê fib()  ‚Üí 2
```
---
## –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```python
import flowtrace
flowtrace.config(show_args=False, show_result=True, show_timing=True)
```
–£–ø—Ä–∞–≤–ª—è—é—Ç —Ç–µ–º, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

| –§–ª–∞–≥          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                  |
| ------------- | ------------------------------------------- |
| `show_args`   | —Å–æ–±–∏—Ä–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π     |
| `show_result` | —Å–æ–±–∏—Ä–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è |
| `show_timing` | –∏–∑–º–µ—Ä—è—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è      |

## –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
```python
@flowtrace.trace(show_args=True)
def foo(x): ...
```

–§–ª–∞–≥–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ, –¥–µ–π—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–µ –≤—ã–∑–æ–≤—ã.
–ü—Ä–∏–º–µ—Ä
```python
import flowtrace

flowtrace.config(show_args=False, show_result=True, show_timing=True)

@flowtrace.trace
def a(x): return b(x) + 1

@flowtrace.trace(show_args=True)
def b(y): return y * 2

a(10)
```
–í—ã–≤–æ–¥:
```
‚Üí a() [0.000032s] ‚Üí 21
  ‚Üí b(y=10) [0.000010s] ‚Üí 20
  ‚Üê b(y=10)
‚Üê a()
```
---
## –ü–æ—á–µ–º—É FlowTrace?

- **–≠—Ç–æ –Ω–µ –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä**. –ü—Ä–æ—Ñ–∞–π–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ ¬´–≥–¥–µ —Å–≥–æ—Ä–µ–ª–æ –≤—Ä–µ–º—è¬ª,
FlowTrace –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å ¬´—á—Ç–æ –∏ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ¬ª.

- **–ü—Ä—è–º–∞—è —Å–≤—è–∑—å —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–æ–π**.
–°–ª—É—à–∞–µ—Ç –±–∞–π—Ç–∫–æ–¥-—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ sys.monitoring (PEP 669).

- **–ë–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∫–æ–¥**.
–ù–∏–∫–∞–∫–æ–≥–æ sys.settrace, monkey-patch–µ–π –∏ –ª–∏—à–Ω–µ–≥–æ –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å.
---

## API (—Ç–µ–∫—É—â–∏–π)
```
from flowtrace import trace, config, start_tracing, stop_tracing, get_trace_data, print_tree
```

- ```@trace(measure_time: bool = True)```
–î–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –≤ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É.
–ï—Å–ª–∏ ```measure_time=True```, –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

- ```start_tracing() / stop_tracing() -> list[CallEvent]```
–ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–ª–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞.
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏.

- ```get_trace_data() -> list[CallEvent]```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.

- ```print_tree(events)```
–ü–µ—á–∞—Ç–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ –≤—ã–∑–æ–≤–æ–≤.

–ú–æ–¥–µ–ª—å —Å–æ–±—ã—Ç–∏—è (```CallEvent```)
``` python
id: int
kind: str
func_name: str
parent_id: int | None
args_repr: str | None
result_repr: str | None
duration: float | None
collect_args: bool
collect_result: bool
collect_timing: bool
```
---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **–¢–æ–ª—å–∫–æ ```PY_START``` / ```PY_RETURN```.**
–°–æ–±—ã—Ç–∏—è ```CALL``` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚Äî —è–¥—Ä–æ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º –∏ –±—ã—Å—Ç—Ä—ã–º.
–ê—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º –≤—ã–∑–æ–≤–∞.

- **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π.**
  FlowTrace –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π (`RAISE`, `RERAISE`, `EXCEPTION_HANDLED`, `PY_UNWIND`).
  –î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –æ—Ç–º–µ—á–µ–Ω–Ω–æ–µ –∫–∞–∫
  `[caught]` (–ø–æ–π–º–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ `[propagated]` (–≤—ã—à–ª–æ –Ω–∞—Ä—É–∂—É).

- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É.**
```perf_counter()``` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏—à—å –ø—Ä–∏ ```measure_time=True```.
–ü—Ä–æ—Å—Ç–∞—è —Å–µ—Å—Å–∏—è ```start```/```stop``` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö.

- **–§–∏–ª—å—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞.**
–ò—Å–∫–ª—é—á–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ –ø–∞–∫–µ—Ç—ã –∏–∑ site-packages.

---
## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –ù—É–ª–µ–≤—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–∞—Ö. –ê—Ä–≥—É–º–µ–Ω—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—Ä–µ–º—è –Ω–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è, –µ—Å–ª–∏ —Ñ–ª–∞–≥–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã.

- –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ò–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ a=5, b=2, –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏.

- –ë–µ–∑ –∫–∞—Å–∫–∞–¥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫. –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –¥–µ–π—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–∫—É—â—É—é —Ñ—É–Ω–∫—Ü–∏—é.
---

## –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è

- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ async/await –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.**

- **–≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–∞—Å—Å—ã –≤ JSON.**

- **–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –∏ —Ñ–∏–ª—å—Ç—Ä—ã include/exclude.**

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.**

---
## –£—á–∞—Å—Ç–∏–µ

PR –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è. –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –∫–æ–º–ø–∞–∫—Ç–Ω–∞ ‚Äî —ç—Ç–æ —É—á–µ–±–Ω—ã–π –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∏–∑—É—á–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ Python 3.12+ –∏ –µ–≥–æ Monitoring API.