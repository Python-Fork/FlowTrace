# FlowTrace ‚Äî —Ä–µ–Ω—Ç–≥–µ–Ω Python-–∫–æ–¥–∞

FlowTrace ‚Äî —ç—Ç–æ **system-level —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤—â–∏–∫** –¥–ª—è Python 3.12 –∏ –Ω–æ–≤–µ–µ.  
–û–Ω –Ω–µ –∏–∑–º–µ—Ä—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –∞ **–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ö–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã**: –∫—Ç–æ –≤—ã–∑–≤–∞–ª –∫–æ–≥–æ, —Å –∫–∞–∫–∏–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∏ —á–µ–º –≤—Å—ë –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å.  

FlowTrace –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ **Monitoring API** –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ CPython ‚Äî –±–µ–∑ `sys.settrace`, –±–µ–∑ monkey-patch–µ–π –∏ –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∫–æ–¥.

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π (`PY_START`) –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã (`PY_RETURN`);
- –°—Ç—Ä–æ–∏—Ç **–¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã;
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏ (`parent_id`);
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ;
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—â—É—Ç–∏–º—ã—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.

---

## üîß –ü—Ä–∏–º–µ—Ä —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é `fib`, –Ω–æ —Ç–µ–ø–µ—Ä—å —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π:

```python
from flowtrace import start_tracing, stop_tracing
from flowtrace.formatters import print_tree

def fib(n):
    return n if n <= 1 else fib(n-1) + fib(n-2)

start_tracing()
fib(3)
events = stop_tracing()

print_tree(events)
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚Üí fib(3)
  ‚Üí fib(2)
    ‚Üí fib(1) [0.000013s]
    ‚Üí fib(0) [0.000011s]
  ‚Üê fib(2) [0.000081s]
  ‚Üí fib(1) [0.000009s]
‚Üê fib(3) [0.000143s]
```

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∑–¥–µ—Å—å ‚Äî —Å–æ–±—ã—Ç–∏–µ –≤—ã–∑–æ–≤–∞ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏.
–û—Ç—Å—Ç—É–ø—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å: –∫—Ç–æ –∫–æ–≥–æ –≤—ã–∑–≤–∞–ª.
FlowTrace –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è,
—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞.

## üß† –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏
```
Monitoring API ‚Üí TraceSession ‚Üí CallEvent ‚Üí Formatter ‚Üí Output
```

1. Monitoring API –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π.

2. TraceSession —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ö –∏ —Å—Ç—Ä–æ–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

3. CallEvent —Ö—Ä–∞–Ω–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏, parent_id, –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≤—Ä–µ–º—è.

4. Formatter –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –≤ —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–π –≤—ã–≤–æ–¥.

5. Output ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏–ª–∏ JSON.

## ‚öôÔ∏è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

FlowTrace –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è API:

| –£—Ä–æ–≤–µ–Ω—å     | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å                            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                   |
| ----------- | ------------------------------------ | -------------------------------------------- |
| Core        | `TraceSession`                       | –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Monitoring API     |
| High-level  | `start_tracing()` / `stop_tracing()` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π –≤—Ä—É—á–Ω—É—é                   |
| Declarative | `@trace`                             | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π |

## üîú –í –ø–ª–∞–Ω–∞—Ö

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ asyncio –∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏;

–°–æ–±—ã—Ç–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π (PY_THROW, PY_RAISE);

–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON.

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE.
